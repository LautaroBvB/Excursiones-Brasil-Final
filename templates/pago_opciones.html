{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Opciones de pago" %}{% endblock %}

{% block content %}
<div id="main">
  <div class="inner">
    <header id="header">
      <a href="#" class="logo"><strong>Opciones de pago</strong> / Excursiones Brasil</a>
    </header>

    <h3 style="margin-top: 4vh">Seleccione su pa√≠s:</h3>
    <form method="post">
      {% csrf_token %}
      <div class="row gtr-uniform">

        <div class="col-12">
          <select name="pais" id="pais" required>
            <option value="argentina">Argentina</option>
            <option value="brasil">Brasil</option>
            <option value="mundo">Resto del mundo</option>
          </select>
        </div>

        <!-- nuevos selects para resto del mundo -->
        <div class="col-12" id="selects-mundo" style="display:none;">
          <div class="row gtr-uniform">
            <div class="col-6 col-12-small">
              <label for="continente">Continente:</label>
              <select name="continente" id="continente">
                <option value="europa">Europa</option>
                <option value="asia">Asia</option>
                <option value="africa">√Åfrica</option>
                <option value="america">Am√©rica</option>
                <option value="oceania">Ocean√≠a</option>
              </select>
            </div>
            <div class="col-6 col-12-small">
              <label for="pais_mundo">Pa√≠s:</label>
              <select name="pais_mundo" id="pais_mundo"></select>
            </div>
          </div>
        </div>

        <!-- Radios -->
        <div id="metodos">
          <div class="col-4 col-12-small">
            <input type="radio" id="enlace_pago" name="medio_pago" value="stripe" checked>
            <label for="enlace_pago">Enlace de pago</label>
          </div>

          <div class="col-4 col-12-small metodo-transfer">
            <input type="radio" id="transferencia" name="medio_pago" value="transferencia">
            <label for="transferencia">Transferencia (Descuento del 10%)</label>
          </div>
        </div>

        <!-- Formulario de datos de env√≠o para transferencia, inicialmente oculto -->
        <div class="col-12" id="form-transferencia" style="display:none; margin-top:2rem;">
          <!-- ‚ö†Ô∏è ahora los inputs est√°n dentro del form principal -->
          <div class="row">
            <div class="col-6 col-12-small">
              <label for="nombre">
                <h4>Nombre</h4>
                <input type="text" id="nombre" name="nombre" placeholder="Nombre">
              </label>
            </div>
            <div class="col-6 col-12-small">
              <label for="direccion">
                <h4>Direcci√≥n</h4>
                <input type="text" id="direccion" name="direccion" placeholder="Direcci√≥n">
              </label>
            </div>
          </div>

          <div class="row">
            <div class="col-6 col-12-small">
              <label for="ciudad">
                <h4>Ciudad</h4>
                <input type="text" id="ciudad" name="ciudad" placeholder="Ciudad">
              </label>
            </div>
            <div class="col-6 col-12-small">
              <label for="codigo_postal">
                <h4>C√≥digo postal</h4>
                <input type="text" id="codigo_postal" name="codigo_postal" placeholder="C√≥digo postal">
              </label>
            </div>
          </div>
        </div>

        <div class="col-12 col-12-small">
          <hr>
          <h4>Total a pagar:</h4>
          <h3 id="total">${{ subtotal|floatformat:2 }}</h3>
        </div>

        <div class="col-12">
          <ul class="actions">
            <li>
              <input type="submit" value="Continuar" class="primary{% if subtotal == 0 %} disabled{% endif %}">
            </li>
          </ul>
        </div>
      </div>
    </form>
  </div>
</div>



<script>
  document.addEventListener("DOMContentLoaded", function () {
    const pais = document.getElementById("pais");
    const transferenciaRadio = document.querySelector(".metodo-transfer");
    const totalEl = document.getElementById("total");
    const enlacePago = document.getElementById("enlace_pago");
    const transferencia = document.getElementById("transferencia");
    const montoBase = parseFloat("{{ subtotal|floatformat:2 }}");
    const descuento = 0.90; // 10% descuento

    const selectsMundo = document.getElementById("selects-mundo");
    const continenteSel = document.getElementById("continente");
    const paisSel = document.getElementById("pais_mundo");

    // üëâ nuevo: formulario de transferencia oculto
    const formTransferencia = document.getElementById("form-transferencia");

    // diccionario continente ‚Üí pa√≠ses
    const paisesPorContinente = {
      europa: [
        "Albania", "Alemania", "Andorra", "Austria", "B√©lgica", "Bosnia y Herzegovina",
        "Bulgaria", "Croacia", "Dinamarca", "Eslovaquia", "Eslovenia", "Espa√±a", "Estonia",
        "Finlandia", "Francia", "Grecia", "Hungr√≠a", "Irlanda", "Islandia", "Italia",
        "Letonia", "Liechtenstein", "Lituania", "Luxemburgo", "Macedonia del Norte",
        "Malta", "M√≥naco", "Montenegro", "Noruega", "Pa√≠ses Bajos", "Polonia", "Portugal",
        "Reino Unido", "Rep√∫blica Checa", "Ruman√≠a", "Rusia", "San Marino", "Serbia",
        "Suecia", "Suiza", "Ucrania", "Vaticano"
      ],
      asia: [
        "Afganist√°n", "Arabia Saud√≠", "Armenia", "Azerbaiy√°n", "Banglad√©s", "Bar√©in",
        "Birmania", "Brun√©i", "But√°n", "Camboya", "China", "Chipre", "Corea del Sur",
        "Emiratos √Årabes Unidos", "Filipinas", "Georgia", "India", "Indonesia", "Irak",
        "Ir√°n", "Israel", "Jap√≥n", "Jordania", "Kazajist√°n", "Kirguist√°n", "Kuwait", "Laos",
        "L√≠bano", "Malasia", "Maldivas", "Mongolia", "Nepal", "Om√°n", "Pakist√°n", "Qatar",
        "Singapur", "Sri Lanka", "Siria", "Tailandia", "Tayikist√°n", "Timor-Leste",
        "Turkmenist√°n", "Turqu√≠a", "Uzbekist√°n", "Vietnam", "Yemen"
      ],
      africa: [
        "Angola", "Argelia", "Ben√≠n", "Botsuana", "Burkina Faso", "Burundi", "Cabo Verde",
        "Camer√∫n", "Chad", "Comoras", "Congo", "Costa de Marfil", "Egipto", "Eritrea",
        "Esuatini", "Etiop√≠a", "Gab√≥n", "Gambia", "Ghana", "Guinea", "Guinea-Bis√°u",
        "Guinea Ecuatorial", "Kenia", "Lesoto", "Liberia", "Libia", "Madagascar", "Malaui",
        "Mali", "Marruecos", "Mauricio", "Mauritania", "Mozambique", "Namibia", "N√≠ger",
        "Nigeria", "Rep√∫blica Centroafricana", "Rep√∫blica Democr√°tica del Congo",
        "Ruanda", "S√°hara Occidental", "Santo Tom√© y Pr√≠ncipe", "Senegal", "Seychelles",
        "Sierra Leona", "Somalia", "Sud√°frica", "Sud√°n", "Sud√°n del Sur", "Tanzania",
        "Togo", "T√∫nez", "Uganda", "Yibuti", "Zambia", "Zimbabue"
      ],
      america: [
        "Antigua y Barbuda", "Bahamas", "Barbados", "Belice", "Bolivia", "Canad√°",
        "Chile", "Colombia", "Costa Rica", "Cuba", "Dominica", "Ecuador", "El Salvador",
        "Estados Unidos", "Granada", "Guatemala", "Guyana", "Hait√≠", "Honduras",
        "Jamaica", "M√©xico", "Nicaragua", "Panam√°", "Paraguay", "Per√∫",
        "Rep√∫blica Dominicana", "San Crist√≥bal y Nieves", "San Vicente y las Granadinas",
        "Santa Luc√≠a", "Surinam", "Trinidad y Tobago", "Uruguay", "Venezuela"
      ],
      oceania: [
        "Australia", "Fiyi", "Islas Cook", "Islas Marshall", "Islas Salom√≥n", "Kiribati",
        "Micronesia", "Nauru", "Nueva Zelanda", "Palaos", "Pap√∫a Nueva Guinea",
        "Samoa", "Tonga", "Tuvalu", "Vanuatu"
      ]
    };

    function actualizarPaises() {
      const cont = continenteSel.value;
      paisSel.innerHTML = "";
      if (paisesPorContinente[cont]) {
        paisesPorContinente[cont].forEach(p => {
          const opt = document.createElement("option");
          opt.value = p;
          opt.textContent = p;
          paisSel.appendChild(opt);
        });
      }
    }

    function actualizarTotal() {
      if (transferencia.checked) {
        totalEl.textContent = "$" + (montoBase * descuento).toFixed(2);
      } else {
        totalEl.textContent = "$" + montoBase.toFixed(2);
      }
    }

    function actualizarOpciones() {
      if (pais.value === "mundo") {
        // ocultar transferencia para resto del mundo
        transferenciaRadio.style.display = "none";
        enlacePago.checked = true;
        selectsMundo.style.display = "block";
        actualizarPaises();
      } else {
        // mostrar transferencia s√≥lo para Arg/Bra
        transferenciaRadio.style.display = "block";
        selectsMundo.style.display = "none";
      }
      // mostrar/ocultar formulario de transferencia
      if (transferencia.checked && pais.value !== "mundo") {
        formTransferencia.style.display = "block";
      } else {
        formTransferencia.style.display = "none";
      }
      actualizarTotal();
    }

    pais.addEventListener("change", actualizarOpciones);
    enlacePago.addEventListener("change", actualizarOpciones);
    transferencia.addEventListener("change", actualizarOpciones);
    continenteSel.addEventListener("change", actualizarPaises);

    // inicial
    actualizarOpciones();
  });
</script>


{% endblock %}