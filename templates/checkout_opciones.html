{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Opciones de pago" %}{% endblock %}

{% block content %}
<div id="main">
  <div class="inner">
    <header id="header">
      <a href="#" class="logo"><strong>Opciones de pago</strong> / Excursiones Brasil</a>
    </header>

    <h3 style="margin-top: 4vh">Seleccione su pa√≠s:</h3>
    <form method="post" action="{% url 'checkout_procesar' %}">
      {% csrf_token %}
      <div class="row gtr-uniform">

        <div class="col-12">
          <select name="pais" id="pais" required>
            <option value="argentina">Argentina</option>
            <option value="brasil">Brasil</option>
            <option value="mundo">Resto del mundo</option>
          </select>
        </div>

        <!-- Radios -->
        <div id="metodos">
          <div class="col-4 col-12-small">
            <input type="radio" id="enlace_pago" name="medio_pago" value="stripe" checked>
            <label for="enlace_pago">Enlace de pago</label>
          </div>

          <div class="col-4 col-12-small metodo-transfer">
            <input type="radio" id="transferencia" name="medio_pago" value="transferencia">
            <label for="transferencia">Transferencia (Descuento del 10%)</label>
          </div>
        </div>

        <div class="col-12 col-12-small">
          <hr>
          <h4>Total a pagar:</h4>
          <h3 id="total">${{ subtotal|floatformat:2 }}</h3>
        </div>

        <div class="col-12">
          <ul class="actions">
            <li><input type="submit" value="Continuar" class="primary"></li>
          </ul>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const pais = document.getElementById("pais");
    const transferenciaRadio = document.querySelector(".metodo-transfer");
    const totalEl = document.getElementById("total");
    const enlacePago = document.getElementById("enlace_pago");
    const transferencia = document.getElementById("transferencia");
    const montoBase = parseFloat("{{ subtotal|floatformat:2 }}");
    const descuento = 0.90; // 10% descuento

  function actualizarTotal() {
    if (transferencia.checked) {
      totalEl.textContent = "$" + (montoBase * descuento).toFixed(2);
    } else {
      totalEl.textContent = "$" + montoBase.toFixed(2);
    }
  }

  function actualizarOpciones() {
    if (pais.value === "mundo") {
      transferenciaRadio.style.display = "none";
      enlacePago.checked = true;
    } else {
      transferenciaRadio.style.display = "block";
    }
    actualizarTotal();
  }

  pais.addEventListener("change", actualizarOpciones);
  enlacePago.addEventListener("change", actualizarTotal);
  transferencia.addEventListener("change", actualizarTotal);

  actualizarOpciones();
});
</script>
{% endblock %}